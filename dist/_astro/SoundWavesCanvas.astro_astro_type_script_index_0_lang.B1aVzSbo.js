import{d as et,s as at,a as nt}from"./canvas-core.C1WeeQst.js";import"./index.CH_iu5NA.js";function ot(){if(window.__audioViz)return window.__audioViz;const r={ctx:null,analyser:null,source:null,stream:null,timeData:null,freqData:null,active:!1,async start(){if(this.active)return;const o=await navigator.mediaDevices.getUserMedia({audio:!0}),v=new(window.AudioContext||window.webkitAudioContext),C=v.createMediaStreamSource(o),m=v.createAnalyser();m.fftSize=2048,m.smoothingTimeConstant=.8,C.connect(m),this.ctx=v,this.source=C,this.analyser=m,this.stream=o,this.timeData=new Uint8Array(m.fftSize),this.freqData=new Uint8Array(m.frequencyBinCount),this.active=!0;try{await v.resume()}catch{}},async stop(){if(this.active){this.active=!1;try{this.source?.disconnect()}catch{}try{this.analyser?.disconnect()}catch{}try{this.stream?.getTracks().forEach(o=>o.stop())}catch{}try{await this.ctx?.close()}catch{}this.source=null,this.analyser=null,this.stream=null,this.ctx=null,this.timeData=null,this.freqData=null}}};return window.__audioViz=r,r}et('canvas[data-canvas="sound-waves"]',r=>{const{ctx:o,destroy:v}=at(r),C=Number(r.dataset.speed??"1")||1,m=(r.dataset.mode??"spectrum").toString(),R=(r.dataset.color??"#00e5ff").toString(),G=(r.dataset.oscColor??R).toString(),w=B(Number(r.dataset.glow??"0.8")),F=L(Number(r.dataset.oscAlpha??"0.7"),.2,1),q=L(Number(r.dataset.reactivity??"1"),.3,2),u=D(Number(r.dataset.bands??"64"),16,160),I=D(Number(r.dataset.lineWidth??"2"),1,6),S=D(Number(r.dataset.lines??"3"),1,5);r.id||(r.id=r.getAttribute("data-audio-id")||`sound-waves-${Math.random().toString(36).slice(2,8)}`);const V=r.id;let y=0,$=1;const M=Math.PI*2;function L(t,e,a){return Math.max(e,Math.min(a,t))}function B(t){return L(t,0,1)}function D(t,e,a){return Math.max(e,Math.min(a,Math.floor(t||e)))}const z=t=>{const e=t.replace("#",""),a=e.length===3?e.split("").map(h=>h+h).join(""):e,c=parseInt(a,16);return{r:c>>16&255,g:c>>8&255,b:c&255}},x=z(R),H=z(G),b=(t,e)=>`rgba(${t.r},${t.g},${t.b},${e})`,N=new Float32Array(u),E=new Float32Array(u),T=Array.from({length:u},(t,e)=>Math.sin(e*12.9898)*43758.5453%M),X=Array.from({length:S},(t,e)=>e*1.4),d=ot();function P(t,e){const a=d.freqData;t.getByteFrequencyData(a);const c=a.length;for(let i=0;i<e.length;i++){const s=Math.floor(h(i/e.length,1,c*.08)),p=Math.min(c-1,Math.floor(h((i+1)/e.length,1,c)));let n=0,g=0;for(let f=s;f<=p;f++)n+=a[f],g++;const l=g?n/g:0;e[i]=B(l/255*q)}function h(i,s,p){return s+(Math.exp(6*i)-1)/(Math.exp(6)-1)*(p-s)}}function j(t,e){const a=d.timeData;t.getByteTimeDomainData(a);const c=D(Math.floor(e*(a.length-1)),0,a.length-1);return(a[c]-128)/128}function J(t,e,a){if(d.active&&d.analyser&&d.freqData)P(d.analyser,E);else for(let n=0;n<u;n++){const g=n/(u-1||1),l=.35+.35*Math.sin((g*3.1+y*.9)*M+T[n]*.3)+.15*Math.sin((g*7.7+y*.6)*M+T[n]*.7)+.05*Math.sin((g*19+y*.3)*M+T[n]*1.3);E[n]=B(l*q)}const c=1-Math.pow(1-.16,$);for(let n=0;n<u;n++)N[n]+=(E[n]-N[n])*c;const h=e*.42,i=Math.max(1,Math.floor(t/(u*10))),s=Math.max(2,Math.floor((t-(u-1)*i)/u));let p=(t-(s*u+i*(u-1)))/2;for(let n=0;n<u;n++){const g=N[n],l=Math.max(1,Math.pow(g,1.1)*h);if(w>.001){const f=o.createLinearGradient(0,a-l,0,a+l);f.addColorStop(0,b(x,w*0)),f.addColorStop(.48,b(x,w*.9)),f.addColorStop(.52,b(x,w*.9)),f.addColorStop(1,b(x,w*0)),o.fillStyle=f,o.fillRect(p-s*.15,a-l-4,s*1.3,l*2+8)}o.fillStyle=b(x,.9),o.fillRect(p,a-l,s,l),o.fillRect(p,a,s,l),p+=s+i}o.fillStyle=b(x,.22),o.fillRect(0,Math.floor(a)-.5,t,1)}function K(t,e){const h=t-32,i=e-12*2,s=.42+.08*Math.sin(y*.6*M),p=i/2*s;for(let n=0;n<S;n++){const g=12+i/2+(n-(S-1)/2)*(i/(S+1))*.55,l=X[n];o.lineWidth=I,o.strokeStyle=b(H,Math.max(.15,F-n*(.2/Math.max(1,S-1)))),o.beginPath();const f=Math.max(180,Math.floor(h/4));for(let k=0;k<=f;k++){const A=k/f,U=16+A*h;let _;if(d.active&&d.analyser&&d.timeData)_=j(d.analyser,A);else{const Z=Math.sin((A*2+y*.45+l)*M),Y=Math.sin((A*5.3+y*.9+l*.7)*M),tt=Math.sin((A*11.7+y*1.7+l*1.3)*M);_=Z*.55+Y*.3+tt*.15}const W=g+_*p*q;k===0?o.moveTo(U,W):o.lineTo(U,W)}o.stroke(),w>.001&&(o.lineWidth=I*3,o.strokeStyle=b(H,w*.25),o.stroke())}}function Q(t){$=t,y+=.01*t*C;const{width:e,height:a}=r.getBoundingClientRect(),c=a/2;o.clearRect(0,0,e,a),nt(o,e,a,y),(m==="spectrum"||m==="both")&&J(e,a,c),(m==="oscilloscope"||m==="both")&&K(e,a)}function O(){const t=document.querySelector(`button[data-audio-toggle][data-target="${V}"]`);if(!t)return;const e=t.querySelector("[data-role=record]"),a=t.querySelector("[data-role=stop]"),c=t.querySelector("[data-role=sr]"),h=()=>{const s=d.active;t.setAttribute("aria-pressed",s?"true":"false"),e&&(e.style.display=s?"none":""),a&&(a.style.display=s?"":"none"),c&&(c.textContent=s?"Stop recording":"Start recording"),t.classList.toggle("bg-emerald-600/70",!s),t.classList.toggle("hover:bg-emerald-600/90",!s),t.classList.toggle("bg-rose-600/70",s),t.classList.toggle("hover:bg-rose-600/90",s)};h();const i=async()=>{try{d.active?await d.stop():await d.start(),h()}catch{t.setAttribute("aria-label","Microphone blocked")}};t.addEventListener("click",i),addEventListener("astro:before-swap",()=>t.removeEventListener("click",i),{once:!0})}return document.readyState==="loading"?addEventListener("DOMContentLoaded",O,{once:!0}):O(),{ctx:o,destroy:v,update:Q}});
